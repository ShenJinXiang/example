<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.shenjinxiang.mvn.mapper.xtwh.BmglMapper">

    <!-- 机构分页查询 -->
    <select id="Dynasearch_jgxx_count" parameterType="map" resultType="int">
        select count(1) from xtwh_jgxx t
        <where>
            <choose>
                <when test="nodeid==null||nodeid==''">
                    <!--
                        and t.sjjgid = #{currentRyxx_ssjgid}
                    -->
                    and t.sjjgid = 0
                </when>
                <otherwise>
                    and t.sjjgid = #{nodeid}
                </otherwise>
            </choose>
            <if test="s_jgmcdm!=null and s_jgmcdm!=''">
                and (t.jgdm like concat('%', #{s_jgmcdm}, '%') or t.jgmc like concat('%', #{s_jgmcdm}, '%'))
            </if>
        </where>
    </select>

    <select id="Dynasearch_jgxx_getData" parameterType="map" resultType="map">
        select
        t.jgid as id,
        t.jgid,
        t.jgdm,
        t.jgmc,
        t.jgjb,
        t.sjjgid,
        (select jgmc from xtwh_jgxx where jgid = t.sjjgid) as sjjgmc,
        t.lrrq,
        t.lrrid,
        (select rymc from xtwh_ryxx where ryid = t.lrrid) as lrrmc,
        convert(length(t.jgid)/4-1,signed) as level,
        (case when (select count(1) from xtwh_jgxx where sjjgid = t.jgid)>0 then 'false' else 'true' end) as leaf,
        'false' as expanded
        from xtwh_jgxx t
        <where>
            <choose>
                <when test="nodeid==null||nodeid==''">
                <!--
                    and t.sjjgid = #{currentRyxx_ssjgid}
                -->
                    and t.sjjgid = 0
                </when>
                <otherwise>
                    and t.sjjgid = #{nodeid}
                </otherwise>
            </choose>
            <if test="s_jgmcdm!=null and s_jgmcdm!=''">
                and (t.jgdm like concat('%', #{s_jgmcdm}, '%') or t.jgmc like concat('%', #{s_jgmcdm}, '%'))
            </if>
        </where>
        order by jgid asc limit ${start}, ${limit}
    </select>


</mapper>